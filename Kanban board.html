<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kanban Board</title>

<style>
body{
  margin:0;
  font-family:Segoe UI,Roboto;
  background:linear-gradient(135deg,#e0e7ff,#f0fdfa);
}
#loginBox{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
#loginBox .box{
  background:#ffffffcc;
  padding:30px;
  border-radius:16px;
  text-align:center;
}
input{
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  width:220px;
}
button{
  margin-top:12px;
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:#4f46e5;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
header{
  background:#4f46e5;
  color:#fff;
  padding:16px;
  display:flex;
  justify-content:space-between;
}
.board{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
  padding:16px;
}
.column{
  background:#ffffffcc;
  border-radius:14px;
  padding:12px;
}
.card{
  background:#eef2ff;
  border-radius:10px;
  padding:10px;
  margin-bottom:8px;
}
.card button{
  width:100%;
  margin-top:6px;
  background:#ef4444;
}
</style>
</head>

<body>

<div id="loginBox">
  <div class="box">
    <h2>เข้าสู่ระบบ</h2>
    <input id="username" placeholder="ชื่อไซต์ / ชื่อผู้ใช้">
    <br>
    <button onclick="login()">เข้าใช้งาน</button>
  </div>
</div>

<div id="app" style="display:none">
<header>
  <strong>KANBAN BOARD</strong>
  <button onclick="logout()" style="background:#ef4444">Logout</button>
</header>

<div class="board">
  <div class="column">
    <h3>TO DO</h3>
    <div id="todo"></div>
    <button onclick="addTask('todo')">➕ Add</button>
  </div>
  <div class="column">
    <h3>IN PROGRESS</h3>
    <div id="doing"></div>
    <button onclick="addTask('doing')">➕ Add</button>
  </div>
  <div class="column">
    <h3>DONE</h3>
    <div id="done"></div>
    <button onclick="addTask('done')">➕ Add</button>
  </div>
</div>
</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, get, set }
  from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDn0I-ZzftCN44f1p9DZsNYS-ozyqwAj9g",
  databaseURL: "https://kanban-board-b7cad-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "kanban-board-b7cad"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentUser = localStorage.getItem("kb-user");
let data = { todo:[], doing:[], done:[] };

window.login = async ()=>{
  const u = document.getElementById("username").value.trim();
  if(!u) return;
  currentUser = u;
  localStorage.setItem("kb-user",u);
  document.getElementById("loginBox").style.display="none";
  document.getElementById("app").style.display="block";
  await load();
};

window.logout = ()=>{
  localStorage.removeItem("kb-user");
  location.reload();
};

if(currentUser){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("app").style.display="block";
  load();
}

async function load(){
  const snap = await get(ref(db,"kanban/"+currentUser));
  if(snap.exists()) data = snap.val();
  render();
}

function save(){
  set(ref(db,"kanban/"+currentUser),data);
}

function render(){
  ["todo","doing","done"].forEach(c=>{
    const el=document.getElementById(c);
    el.innerHTML="";
    data[c].forEach((t,i)=>{
      const d=document.createElement("div");
      d.className="card";
      d.innerHTML=`${t}
        <button onclick="del('${c}',${i})">ลบ</button>`;
      el.appendChild(d);
    });
  });
}

window.addTask = c=>{
  const t=prompt("ชื่องาน");
  if(!t) return;
  data[c].push(t);
  render();
  save();
};

window.del = (c,i)=>{
  data[c].splice(i,1);
  render();
  save();
};
</script>

</body>
</html>
